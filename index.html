<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b0f1a">

  <!-- â”€â”€â”€â”€â”€ Open Graph / Twitter â”€â”€â”€â”€â”€ -->
  <meta property="og:type"        content="website">
  <meta property="og:site_name"   content="ì ì‹¬ë©”ë‰´ì¶”ì²œ">
  <meta property="og:title"       content="ì ì‹¬ë©”ë‰´ì¶”ì²œ by ì„±ì¤€ â€“ ì ì‹¬ ë­ ë¨¹ì§€?">
  <meta property="og:description" content="ë£°ë ›ì„ ëŒë ¤ ì˜¤ëŠ˜ì˜ ì ì‹¬ ë©”ë‰´ë¥¼ ëœë¤ìœ¼ë¡œ ì¶”ì²œë°›ì•„ ë³´ì„¸ìš”!">
  <meta property="og:url"         content="https://seongjun21.github.io/lunch-sj/">
  <meta property="og:image"       content="https://seongjun21.github.io/lunch-sj/Sun%20nail-image.png">
  <meta property="og:image:width"  content="1200">
  <meta property="og:image:height" content="630">

  <meta name="twitter:card"        content="summary_large_image">
  <meta name="twitter:title"       content="ì ì‹¬ë©”ë‰´ì¶”ì²œ by ì„±ì¤€">
  <meta name="twitter:description" content="ë£°ë › í•œ ë²ˆìœ¼ë¡œ ë¹ ë¥´ê²Œ ì ì‹¬ ë©”ë‰´ ê²°ì •!">
  <meta name="twitter:image"       content="https://seongjun21.github.io/lunch-sj/Sun%20nail-image.png">

  <title>ì ì‹¬ë©”ë‰´ì¶”ì²œ | LunchWheel</title>
  <!-- â€¦ ê¸°ì¡´ CSS & CDN ë§í¬ ê·¸ëŒ€ë¡œ â€¦ -->
</head>
<body>
  <div class="app">
    <!-- Left: Roulette -->
    <section class="card">
      <div class="card-header">
        <div class="title">
          ğŸ½ï¸ ì ì‹¬ ë©”ë‰´ ë£°ë ›
          <span class="badge">GSAP ê°ì† íšŒì „</span>
        </div>
        <span class="badge" id="countBadge">0ê°œ ë©”ë‰´</span>
      </div>

      <div class="card-body">
        <div class="wheel-wrap">
          <div class="wheel-stage">
            <div class="wheel-shadow"></div>
            <div class="pointer" aria-hidden="true"></div>

            <svg viewBox="-200 -200 400 400" role="img" aria-label="ì ì‹¬ ë©”ë‰´ ë£°ë ›">
              <!-- íšŒì „ì‹œí‚¤ëŠ” ê·¸ë£¹ -->
              <g id="wheelGroup"></g>

              <!-- ë°”ê¹¥ í…Œë‘ë¦¬ -->
              <circle cx="0" cy="0" r="190" fill="none" stroke="rgba(255,255,255,.22)" stroke-width="2"></circle>
            </svg>

            <div class="hub">GO</div>
          </div>
        </div>

        <div class="result">
          <div>
            <div class="label">ì„ íƒëœ ë©”ë‰´</div>
          </div>
          <div class="value" id="resultText">â€”</div>
        </div>

        <div class="btn-row">
          <button id="spinBtn">ë£°ë › ëŒë¦¬ê¸°</button>
          <button class="secondary" id="shuffleBtn">ìƒ‰ìƒ/ìˆœì„œ ì„ê¸°</button>
          <button class="secondary" id="resetBtn">íšŒì „ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </section>

    <!-- Right: Menu list -->
    <aside class="card">
      <div class="card-header">
        <div class="title">ğŸ§¾ ë©”ë‰´ ì„¤ì •</div>
        <span class="badge">ì¶”ê°€/ì‚­ì œ ê°€ëŠ¥</span>
      </div>
      <div class="card-body">
        <div class="menu-editor">
          <div class="input-row">
            <input id="menuInput" type="text" placeholder="ì˜ˆ) ê¹€ì¹˜ì°Œê°œ" maxlength="18" />
            <button class="secondary" id="addBtn">ì¶”ê°€</button>
          </div>

          <div class="chips" id="chips"></div>

          <div class="hint">
            â€¢ íŒŒì´ ì¡°ê° ì¤‘ì•™ì— ë©”ë‰´ëª…ì´ í‘œì‹œë©ë‹ˆë‹¤.<br/>
            â€¢ â€œë£°ë › ëŒë¦¬ê¸°â€ë¥¼ ëˆ„ë¥´ë©´ ì—¬ëŸ¬ ë°”í€´ íšŒì „ í›„ ì„œì„œíˆ ê°ì†í•˜ì—¬ í•œ ë©”ë‰´ì—ì„œ ë©ˆì¶¥ë‹ˆë‹¤.<br/>
            â€¢ í¬ì¸í„°(ìœ„ ì‚¼ê°í˜•)ê°€ ê°€ë¦¬í‚¤ëŠ” ì¡°ê°ì´ ìµœì¢… ì„ íƒì…ë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </aside>
  </div>

  <script>
    // ===== Utils =====
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
    function degToRad(deg){ return (deg * Math.PI) / 180; }

    // SVG arc path (center 0,0)
    function wedgePath(r, a0, a1) {
      // angles in radians, 0 rad = +x, CCW positive
      const x0 = r * Math.cos(a0), y0 = r * Math.sin(a0);
      const x1 = r * Math.cos(a1), y1 = r * Math.sin(a1);
      const largeArc = (a1 - a0) % (Math.PI * 2) > Math.PI ? 1 : 0;
      return [
        `M 0 0`,
        `L ${x0.toFixed(3)} ${y0.toFixed(3)}`,
        `A ${r} ${r} 0 ${largeArc} 1 ${x1.toFixed(3)} ${y1.toFixed(3)}`,
        `Z`
      ].join(" ");
    }

    function hslColor(i, n) {
      // ë³´ê¸° ì¢‹ì€ ë²”ìœ„ë¡œ hue ë¶„ì‚°
      const hue = (i * (360 / n) + 210) % 360;
      return `hsl(${hue} 70% 52%)`;
    }

    // ===== State =====
    let menus = [
      "ê¹€ì¹˜ì°Œê°œ", "êµ­ë°¥", "ëˆê¹ŒìŠ¤", "ì´ˆë°¥",
      "ë¹„ë¹”ë°¥", "íŒŒìŠ¤íƒ€", "ìƒëŸ¬ë“œ", "ë¼ë©˜"
    ];

    let currentRotation = 0; // degrees
    let isSpinning = false;

    const wheelGroup = document.getElementById("wheelGroup");
    const resultText = document.getElementById("resultText");
    const countBadge = document.getElementById("countBadge");

    const chipsEl = document.getElementById("chips");
    const menuInput = document.getElementById("menuInput");

    const spinBtn = document.getElementById("spinBtn");
    const addBtn = document.getElementById("addBtn");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const resetBtn = document.getElementById("resetBtn");

    // ===== Build Wheel =====
    function rebuildChips(){
      chipsEl.innerHTML = "";
      menus.forEach((m, idx) => {
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.innerHTML = `
          <span>${escapeHtml(m)}</span>
          <button title="ì‚­ì œ" aria-label="${m} ì‚­ì œ">Ã—</button>
        `;
        chip.querySelector("button").addEventListener("click", () => {
          menus.splice(idx, 1);
          if (menus.length < 2) {
            // ìµœì†Œ 2ê°œëŠ” ìœ ì§€ (ë£°ë › ì˜ë¯¸)
            menus = ["ë©”ë‰´1", "ë©”ë‰´2"];
          }
          rebuildAll();
        });
        chipsEl.appendChild(chip);
      });
    }

    function rebuildWheel(){
      wheelGroup.innerHTML = "";
      const n = menus.length;
      countBadge.textContent = `${n}ê°œ ë©”ë‰´`;

      const r = 185;
      const sliceAngle = (Math.PI * 2) / n;

      // í¬ì¸í„°ëŠ” "ìœ„ìª½" (svg ì¢Œí‘œì—ì„œ -Y ë°©í–¥ = -90deg)ì„ ê°€ë¦¬í‚µë‹ˆë‹¤.
      // wheelì„ íšŒì „ì‹œì¼œ íŠ¹ì • ì¡°ê°ì˜ ì¤‘ì•™ì´ -90deg ìœ„ì¹˜ë¡œ ì˜¤ê²Œ ë§Œë“¤ ê²ƒì…ë‹ˆë‹¤.

      for (let i = 0; i < n; i++){
        const a0 = i * sliceAngle;
        const a1 = (i + 1) * sliceAngle;

        // Path
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", wedgePath(r, a0, a1));
        path.setAttribute("fill", hslColor(i, n));
        path.setAttribute("class", "slice-path");

        // Text position: slice center angle
        const mid = (a0 + a1) / 2;

        // ì¤‘ì•™ í…ìŠ¤íŠ¸ë¥¼ "ì¡°ê° ê°€ìš´ë°"ì— ë‘ê¸° ìœ„í•´ ë°˜ì§€ë¦„ì˜ 60% ì§€ì ì— ë°°ì¹˜
        const tx = (r * 0.62) * Math.cos(mid);
        const ty = (r * 0.62) * Math.sin(mid);

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", tx.toFixed(2));
        text.setAttribute("y", ty.toFixed(2));
        text.setAttribute("text-anchor", "middle");
        text.setAttribute("dominant-baseline", "middle");
        text.setAttribute("font-size", String(clamp(26 - n, 12, 18)));
        text.setAttribute("class", "slice-text");

        // ê¸€ìê°€ íšŒì „ì— ë”°ë¼ ê°™ì´ ëŒì•„ê°€ë˜, ì½ê¸° ì‰¬ìš°ë¼ê³  "ë°”ê¹¥ìª½ì„ í–¥í•´" ì•½ê°„ íšŒì „
        // (ì›í•˜ì‹œë©´ í•­ìƒ ìˆ˜í‰ìœ¼ë¡œ ìœ ì§€í•˜ëŠ” ë°©ì‹ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤)
        const rotateDeg = (mid * 180 / Math.PI);
        text.setAttribute("transform", `rotate(${rotateDeg.toFixed(2)} ${tx.toFixed(2)} ${ty.toFixed(2)})`);

        text.textContent = menus[i];

        wheelGroup.appendChild(path);
        wheelGroup.appendChild(text);
      }

      // í˜„ì¬ íšŒì „ ì ìš©
      gsap.set(wheelGroup, { rotation: currentRotation, transformOrigin: "50% 50%" });
    }

    function rebuildAll(){
      // íšŒì „ ì¤‘ì´ë©´ ê°•ì œë¡œ ì¤‘ì§€í•˜ì§€ ì•Šê³  UIë§Œ ì ê¸ˆ í•´ì œ ë°©ì§€
      if (isSpinning) return;

      // ê²°ê³¼ ì´ˆê¸°í™”ëŠ” ë©”ë‰´ê°€ ë³€í•  ë•Œë§Œ
      resultText.textContent = "â€”";
      rebuildChips();
      rebuildWheel();
    }

    // HTML escape
    function escapeHtml(str){
      return str.replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }

    // ===== Spin Logic =====
    function pickRandomIndex(n){
      return Math.floor(Math.random() * n);
    }

    function spin(){
      const n = menus.length;
      if (n < 2) return;
      if (isSpinning) return;

      isSpinning = true;
      spinBtn.disabled = true;
      addBtn.disabled = true;
      shuffleBtn.disabled = true;
      resetBtn.disabled = true;

      const idx = pickRandomIndex(n);

      // ê° ì¡°ê° ì¤‘ì•™ì´ í¬ì¸í„°(-90deg)ì— ì˜¤ë„ë¡ ëª©í‘œ íšŒì „ ê³„ì‚°
      // ì¡°ê° ì¤‘ì•™ ê°ë„(midAngleDeg)ëŠ” 0deg = +X, CCW +
      const sliceDeg = 360 / n;
      const midAngleDeg = idx * sliceDeg + sliceDeg / 2;

      // í¬ì¸í„°ê°€ ê°€ë¦¬í‚¤ëŠ” ë°©í–¥ì€ -90deg
      // wheelGroup rotationì€ ì‹œê³„ë°©í–¥(+)ë¡œë„ ë™ì‘í•˜ì§€ë§Œ GSAP rotationì€ ê¸°ë³¸ì ìœ¼ë¡œ ì‹œê³„ë°©í–¥(+) ëŠë‚Œìœ¼ë¡œ ë³´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      // SVG ì¢Œí‘œ ê¸°ì¤€ê³¼ ì‹œê° ê¸°ì¤€ì„ ë§ì¶”ê¸° ìœ„í•´ ì•„ë˜ì²˜ëŸ¼ "í¬ì¸í„°(-90) - ì¡°ê°ì¤‘ì•™(mid)"ë¥¼ ì‚¬ìš©.
      const targetAlign = -90 - midAngleDeg;

      // í˜„ì¬ íšŒì „ì—ì„œ ì—¬ëŸ¬ ë°”í€´ ë” ëŒê³ (targetAlignì— ìˆ˜ë ´) ê°ì†
      const extraSpins = 6 + Math.floor(Math.random() * 4); // 6~9ë°”í€´
      const targetRotation = currentRotation + extraSpins * 360 + normalizeDelta(targetAlign - currentRotation);

      // ë¶€ë“œëŸ¬ìš´ ê°ì†(ì„œì„œíˆ ì†ë„ ì¤„ì–´ë“¦)
      gsap.to(wheelGroup, {
        rotation: targetRotation,
        duration: 4.2,
        ease: "power4.out",
        onUpdate: () => {
          currentRotation = gsap.getProperty(wheelGroup, "rotation");
        },
        onComplete: () => {
          currentRotation = gsap.getProperty(wheelGroup, "rotation");
          isSpinning = false;

          // ê²°ê³¼ í‘œì‹œ
          resultText.textContent = menus[idx];

          // ë²„íŠ¼ ë³µêµ¬
          spinBtn.disabled = false;
          addBtn.disabled = false;
          shuffleBtn.disabled = false;
          resetBtn.disabled = false;

          // ì•½í•œ íŒ ì• ë‹ˆë©”ì´ì…˜
          gsap.fromTo(resultText, { scale: 0.98, opacity: 0.6 }, { scale: 1, opacity: 1, duration: 0.25, ease: "power2.out" });
        }
      });
    }

    // íšŒì „ ê° ì°¨ì´ë¥¼ -180~+180 ë²”ìœ„ë¡œ ì •ê·œí™”í•´ì„œ "ê°€ì¥ ìì—°ìŠ¤ëŸ¬ìš´ ë°©í–¥"ìœ¼ë¡œ ëª©í‘œë¥¼ ë§ì¶¥ë‹ˆë‹¤.
    function normalizeDelta(delta){
      let d = ((delta % 360) + 360) % 360; // 0..359
      if (d > 180) d -= 360; // -180..180
      return d;
    }

    // ===== UI Handlers =====
    spinBtn.addEventListener("click", spin);

    addBtn.addEventListener("click", () => {
      if (isSpinning) return;
      const v = menuInput.value.trim();
      if (!v) return;
      menus.push(v);
      menuInput.value = "";
      rebuildAll();
    });

    menuInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") addBtn.click();
    });

    shuffleBtn.addEventListener("click", () => {
      if (isSpinning) return;
      // ìˆœì„œ ì„ê¸°
      for (let i = menus.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [menus[i], menus[j]] = [menus[j], menus[i]];
      }
      rebuildAll();
    });

    resetBtn.addEventListener("click", () => {
      if (isSpinning) return;
      currentRotation = 0;
      gsap.set(wheelGroup, { rotation: 0, transformOrigin: "50% 50%" });
      resultText.textContent = "â€”";
    });

    // ===== Init =====
    rebuildAll();

  /* â”€â”€â”€ PWA : ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ â”€â”€â”€ */
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () =>
      navigator.serviceWorker.register('./sw.js')
        .catch(console.error)
    );
  }
  </script>
</body>
</html>
