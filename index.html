<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì ì‹¬ ë©”ë‰´ ë£°ë ›</title>

  <!-- GSAP CDN -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

  <style>
    :root{
      --bg:#0b0f1a;
      --panel:#11182a;
      --line:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.65);
      --accent:#7c5cff;
      --accent2:#2ee9a6;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", "Apple SD Gothic Neo", Arial, sans-serif;
      background: radial-gradient(1200px 700px at 20% 0%, #1a2455 0%, rgba(26,36,85,0) 60%),
                  radial-gradient(1000px 600px at 80% 20%, #123a2e 0%, rgba(18,58,46,0) 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .app{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:18px;
    }

    @media (max-width: 860px){
      .app{ grid-template-columns:1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow: 0 16px 50px rgba(0,0,0,.45);
      overflow:hidden;
    }

    .card-header{
      padding:16px 18px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .title{
      font-size:16px;
      font-weight:700;
      letter-spacing:-.2px;
      display:flex;
      align-items:center;
      gap:10px;
    }

    .badge{
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
    }

    .card-body{ padding:16px 18px; }

    /* Wheel area */
    .wheel-wrap{
      position:relative;
      width:100%;
      aspect-ratio: 1/1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:10px;
    }

    .wheel-stage{
      position:relative;
      width:min(520px, 100%);
      aspect-ratio:1/1;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .wheel-shadow{
      position:absolute;
      inset:2%;
      border-radius:50%;
      background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.18), rgba(255,255,255,.03) 55%, rgba(0,0,0,.65));
      filter: blur(2px);
      opacity:.55;
      z-index:0;
    }

    svg{
      width:100%;
      height:100%;
      display:block;
      z-index:1;
    }

    .pointer{
      position:absolute;
      top:-2px;
      left:50%;
      transform: translateX(-50%);
      width:0;
      height:0;
      border-left:14px solid transparent;
      border-right:14px solid transparent;
      border-bottom:26px solid var(--accent2);
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.55));
      z-index:5;
    }

    .hub{
      position:absolute;
      width:20%;
      aspect-ratio:1/1;
      border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), rgba(255,255,255,.06) 55%, rgba(0,0,0,.35));
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 14px 40px rgba(0,0,0,.55);
      z-index:4;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:800;
      color:rgba(255,255,255,.92);
      letter-spacing:-.3px;
      pointer-events:none;
    }

    .result{
      margin-top:12px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.20);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .result .label{
      font-size:12px;
      color:var(--muted);
    }
    .result .value{
      font-size:16px;
      font-weight:800;
      color: #fff;
      text-shadow: 0 10px 24px rgba(0,0,0,.55);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width: 70%;
      text-align:right;
    }

    .btn-row{
      display:flex;
      gap:10px;
      margin-top:14px;
      flex-wrap:wrap;
    }

    button{
      appearance:none;
      border:none;
      cursor:pointer;
      border-radius:14px;
      padding:12px 14px;
      font-weight:800;
      color:white;
      background: linear-gradient(135deg, var(--accent), #4a8bff);
      box-shadow: 0 14px 34px rgba(0,0,0,.35);
      transition: transform .08s ease, filter .15s ease;
      user-select:none;
    }
    button:active{ transform: translateY(1px) scale(.99); }
    button.secondary{
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      box-shadow:none;
      color:rgba(255,255,255,.88);
    }
    button:disabled{
      opacity:.55;
      cursor:not-allowed;
      filter: grayscale(.1);
    }

    /* Menu editor */
    .menu-editor{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .input-row{
      display:flex;
      gap:10px;
    }

    input[type="text"]{
      flex:1;
      background: rgba(0,0,0,.28);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px 14px;
      color:var(--text);
      outline:none;
    }
    input::placeholder{ color: rgba(255,255,255,.38); }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
      font-size:13px;
      color: rgba(255,255,255,.88);
    }

    .chip button{
      padding:0;
      width:22px;
      height:22px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      box-shadow:none;
      font-weight:900;
      line-height:1;
    }

    .hint{
      font-size:12px;
      color: var(--muted);
      line-height:1.4;
    }

    /* SVG text styling */
    .slice-text{
      font-weight:800;
      fill: rgba(255,255,255,.92);
      paint-order: stroke;
      stroke: rgba(0,0,0,.35);
      stroke-width: 2.5px;
      letter-spacing:-.2px;
      user-select:none;
    }

    .slice-path{
      stroke: rgba(255,255,255,.15);
      stroke-width: 1;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Left: Roulette -->
    <section class="card">
      <div class="card-header">
        <div class="title">
          ğŸ½ï¸ ì ì‹¬ ë©”ë‰´ ë£°ë ›
          <span class="badge">GSAP ê°ì† íšŒì „</span>
        </div>
        <span class="badge" id="countBadge">0ê°œ ë©”ë‰´</span>
      </div>

      <div class="card-body">
        <div class="wheel-wrap">
          <div class="wheel-stage">
            <div class="wheel-shadow"></div>
            <div class="pointer" aria-hidden="true"></div>

            <svg viewBox="-200 -200 400 400" role="img" aria-label="ì ì‹¬ ë©”ë‰´ ë£°ë ›">
              <!-- íšŒì „ì‹œí‚¤ëŠ” ê·¸ë£¹ -->
              <g id="wheelGroup"></g>

              <!-- ë°”ê¹¥ í…Œë‘ë¦¬ -->
              <circle cx="0" cy="0" r="190" fill="none" stroke="rgba(255,255,255,.22)" stroke-width="2"></circle>
            </svg>

            <div class="hub">GO</div>
          </div>
        </div>

        <div class="result">
          <div>
            <div class="label">ì„ íƒëœ ë©”ë‰´</div>
          </div>
          <div class="value" id="resultText">â€”</div>
        </div>

        <div class="btn-row">
          <button id="spinBtn">ë£°ë › ëŒë¦¬ê¸°</button>
          <button class="secondary" id="shuffleBtn">ìƒ‰ìƒ/ìˆœì„œ ì„ê¸°</button>
          <button class="secondary" id="resetBtn">íšŒì „ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </section>

    <!-- Right: Menu list -->
    <aside class="card">
      <div class="card-header">
        <div class="title">ğŸ§¾ ë©”ë‰´ ì„¤ì •</div>
        <span class="badge">ì¶”ê°€/ì‚­ì œ ê°€ëŠ¥</span>
      </div>
      <div class="card-body">
        <div class="menu-editor">
          <div class="input-row">
            <input id="menuInput" type="text" placeholder="ì˜ˆ) ê¹€ì¹˜ì°Œê°œ" maxlength="18" />
            <button class="secondary" id="addBtn">ì¶”ê°€</button>
          </div>

          <div class="chips" id="chips"></div>

          <div class="hint">
            â€¢ íŒŒì´ ì¡°ê° ì¤‘ì•™ì— ë©”ë‰´ëª…ì´ í‘œì‹œë©ë‹ˆë‹¤.<br/>
            â€¢ â€œë£°ë › ëŒë¦¬ê¸°â€ë¥¼ ëˆ„ë¥´ë©´ ì—¬ëŸ¬ ë°”í€´ íšŒì „ í›„ ì„œì„œíˆ ê°ì†í•˜ì—¬ í•œ ë©”ë‰´ì—ì„œ ë©ˆì¶¥ë‹ˆë‹¤.<br/>
            â€¢ í¬ì¸í„°(ìœ„ ì‚¼ê°í˜•)ê°€ ê°€ë¦¬í‚¤ëŠ” ì¡°ê°ì´ ìµœì¢… ì„ íƒì…ë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </aside>
  </div>

  <script>
    // ===== Utils =====
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
    function degToRad(deg){ return (deg * Math.PI) / 180; }

    // SVG arc path (center 0,0)
    function wedgePath(r, a0, a1) {
      // angles in radians, 0 rad = +x, CCW positive
      const x0 = r * Math.cos(a0), y0 = r * Math.sin(a0);
      const x1 = r * Math.cos(a1), y1 = r * Math.sin(a1);
      const largeArc = (a1 - a0) % (Math.PI * 2) > Math.PI ? 1 : 0;
      return [
        `M 0 0`,
        `L ${x0.toFixed(3)} ${y0.toFixed(3)}`,
        `A ${r} ${r} 0 ${largeArc} 1 ${x1.toFixed(3)} ${y1.toFixed(3)}`,
        `Z`
      ].join(" ");
    }

    function hslColor(i, n) {
      // ë³´ê¸° ì¢‹ì€ ë²”ìœ„ë¡œ hue ë¶„ì‚°
      const hue = (i * (360 / n) + 210) % 360;
      return `hsl(${hue} 70% 52%)`;
    }

    // ===== State =====
    let menus = [
      "ê¹€ì¹˜ì°Œê°œ", "êµ­ë°¥", "ëˆê¹ŒìŠ¤", "ì´ˆë°¥",
      "ë¹„ë¹”ë°¥", "íŒŒìŠ¤íƒ€", "ìƒëŸ¬ë“œ", "ë¼ë©˜"
    ];

    let currentRotation = 0; // degrees
    let isSpinning = false;

    const wheelGroup = document.getElementById("wheelGroup");
    const resultText = document.getElementById("resultText");
    const countBadge = document.getElementById("countBadge");

    const chipsEl = document.getElementById("chips");
    const menuInput = document.getElementById("menuInput");

    const spinBtn = document.getElementById("spinBtn");
    const addBtn = document.getElementById("addBtn");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const resetBtn = document.getElementById("resetBtn");

    // ===== Build Wheel =====
    function rebuildChips(){
      chipsEl.innerHTML = "";
      menus.forEach((m, idx) => {
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.innerHTML = `
          <span>${escapeHtml(m)}</span>
          <button title="ì‚­ì œ" aria-label="${m} ì‚­ì œ">Ã—</button>
        `;
        chip.querySelector("button").addEventListener("click", () => {
          menus.splice(idx, 1);
          if (menus.length < 2) {
            // ìµœì†Œ 2ê°œëŠ” ìœ ì§€ (ë£°ë › ì˜ë¯¸)
            menus = ["ë©”ë‰´1", "ë©”ë‰´2"];
          }
          rebuildAll();
        });
        chipsEl.appendChild(chip);
      });
    }

    function rebuildWheel(){
      wheelGroup.innerHTML = "";
      const n = menus.length;
      countBadge.textContent = `${n}ê°œ ë©”ë‰´`;

      const r = 185;
      const sliceAngle = (Math.PI * 2) / n;

      // í¬ì¸í„°ëŠ” "ìœ„ìª½" (svg ì¢Œí‘œì—ì„œ -Y ë°©í–¥ = -90deg)ì„ ê°€ë¦¬í‚µë‹ˆë‹¤.
      // wheelì„ íšŒì „ì‹œì¼œ íŠ¹ì • ì¡°ê°ì˜ ì¤‘ì•™ì´ -90deg ìœ„ì¹˜ë¡œ ì˜¤ê²Œ ë§Œë“¤ ê²ƒì…ë‹ˆë‹¤.

      for (let i = 0; i < n; i++){
        const a0 = i * sliceAngle;
        const a1 = (i + 1) * sliceAngle;

        // Path
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", wedgePath(r, a0, a1));
        path.setAttribute("fill", hslColor(i, n));
        path.setAttribute("class", "slice-path");

        // Text position: slice center angle
        const mid = (a0 + a1) / 2;

        // ì¤‘ì•™ í…ìŠ¤íŠ¸ë¥¼ "ì¡°ê° ê°€ìš´ë°"ì— ë‘ê¸° ìœ„í•´ ë°˜ì§€ë¦„ì˜ 60% ì§€ì ì— ë°°ì¹˜
        const tx = (r * 0.62) * Math.cos(mid);
        const ty = (r * 0.62) * Math.sin(mid);

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", tx.toFixed(2));
        text.setAttribute("y", ty.toFixed(2));
        text.setAttribute("text-anchor", "middle");
        text.setAttribute("dominant-baseline", "middle");
        text.setAttribute("font-size", String(clamp(26 - n, 12, 18)));
        text.setAttribute("class", "slice-text");

        // ê¸€ìê°€ íšŒì „ì— ë”°ë¼ ê°™ì´ ëŒì•„ê°€ë˜, ì½ê¸° ì‰¬ìš°ë¼ê³  "ë°”ê¹¥ìª½ì„ í–¥í•´" ì•½ê°„ íšŒì „
        // (ì›í•˜ì‹œë©´ í•­ìƒ ìˆ˜í‰ìœ¼ë¡œ ìœ ì§€í•˜ëŠ” ë°©ì‹ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤)
        const rotateDeg = (mid * 180 / Math.PI);
        text.setAttribute("transform", `rotate(${rotateDeg.toFixed(2)} ${tx.toFixed(2)} ${ty.toFixed(2)})`);

        text.textContent = menus[i];

        wheelGroup.appendChild(path);
        wheelGroup.appendChild(text);
      }

      // í˜„ì¬ íšŒì „ ì ìš©
      gsap.set(wheelGroup, { rotation: currentRotation, transformOrigin: "50% 50%" });
    }

    function rebuildAll(){
      // íšŒì „ ì¤‘ì´ë©´ ê°•ì œë¡œ ì¤‘ì§€í•˜ì§€ ì•Šê³  UIë§Œ ì ê¸ˆ í•´ì œ ë°©ì§€
      if (isSpinning) return;

      // ê²°ê³¼ ì´ˆê¸°í™”ëŠ” ë©”ë‰´ê°€ ë³€í•  ë•Œë§Œ
      resultText.textContent = "â€”";
      rebuildChips();
      rebuildWheel();
    }

    // HTML escape
    function escapeHtml(str){
      return str.replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }

    // ===== Spin Logic =====
    function pickRandomIndex(n){
      return Math.floor(Math.random() * n);
    }

    function spin(){
      const n = menus.length;
      if (n < 2) return;
      if (isSpinning) return;

      isSpinning = true;
      spinBtn.disabled = true;
      addBtn.disabled = true;
      shuffleBtn.disabled = true;
      resetBtn.disabled = true;

      const idx = pickRandomIndex(n);

      // ê° ì¡°ê° ì¤‘ì•™ì´ í¬ì¸í„°(-90deg)ì— ì˜¤ë„ë¡ ëª©í‘œ íšŒì „ ê³„ì‚°
      // ì¡°ê° ì¤‘ì•™ ê°ë„(midAngleDeg)ëŠ” 0deg = +X, CCW +
      const sliceDeg = 360 / n;
      const midAngleDeg = idx * sliceDeg + sliceDeg / 2;

      // í¬ì¸í„°ê°€ ê°€ë¦¬í‚¤ëŠ” ë°©í–¥ì€ -90deg
      // wheelGroup rotationì€ ì‹œê³„ë°©í–¥(+)ë¡œë„ ë™ì‘í•˜ì§€ë§Œ GSAP rotationì€ ê¸°ë³¸ì ìœ¼ë¡œ ì‹œê³„ë°©í–¥(+) ëŠë‚Œìœ¼ë¡œ ë³´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      // SVG ì¢Œí‘œ ê¸°ì¤€ê³¼ ì‹œê° ê¸°ì¤€ì„ ë§ì¶”ê¸° ìœ„í•´ ì•„ë˜ì²˜ëŸ¼ "í¬ì¸í„°(-90) - ì¡°ê°ì¤‘ì•™(mid)"ë¥¼ ì‚¬ìš©.
      const targetAlign = -90 - midAngleDeg;

      // í˜„ì¬ íšŒì „ì—ì„œ ì—¬ëŸ¬ ë°”í€´ ë” ëŒê³ (targetAlignì— ìˆ˜ë ´) ê°ì†
      const extraSpins = 6 + Math.floor(Math.random() * 4); // 6~9ë°”í€´
      const targetRotation = currentRotation + extraSpins * 360 + normalizeDelta(targetAlign - currentRotation);

      // ë¶€ë“œëŸ¬ìš´ ê°ì†(ì„œì„œíˆ ì†ë„ ì¤„ì–´ë“¦)
      gsap.to(wheelGroup, {
        rotation: targetRotation,
        duration: 4.2,
        ease: "power4.out",
        onUpdate: () => {
          currentRotation = gsap.getProperty(wheelGroup, "rotation");
        },
        onComplete: () => {
          currentRotation = gsap.getProperty(wheelGroup, "rotation");
          isSpinning = false;

          // ê²°ê³¼ í‘œì‹œ
          resultText.textContent = menus[idx];

          // ë²„íŠ¼ ë³µêµ¬
          spinBtn.disabled = false;
          addBtn.disabled = false;
          shuffleBtn.disabled = false;
          resetBtn.disabled = false;

          // ì•½í•œ íŒ ì• ë‹ˆë©”ì´ì…˜
          gsap.fromTo(resultText, { scale: 0.98, opacity: 0.6 }, { scale: 1, opacity: 1, duration: 0.25, ease: "power2.out" });
        }
      });
    }

    // íšŒì „ ê° ì°¨ì´ë¥¼ -180~+180 ë²”ìœ„ë¡œ ì •ê·œí™”í•´ì„œ "ê°€ì¥ ìì—°ìŠ¤ëŸ¬ìš´ ë°©í–¥"ìœ¼ë¡œ ëª©í‘œë¥¼ ë§ì¶¥ë‹ˆë‹¤.
    function normalizeDelta(delta){
      let d = ((delta % 360) + 360) % 360; // 0..359
      if (d > 180) d -= 360; // -180..180
      return d;
    }

    // ===== UI Handlers =====
    spinBtn.addEventListener("click", spin);

    addBtn.addEventListener("click", () => {
      if (isSpinning) return;
      const v = menuInput.value.trim();
      if (!v) return;
      menus.push(v);
      menuInput.value = "";
      rebuildAll();
    });

    menuInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") addBtn.click();
    });

    shuffleBtn.addEventListener("click", () => {
      if (isSpinning) return;
      // ìˆœì„œ ì„ê¸°
      for (let i = menus.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [menus[i], menus[j]] = [menus[j], menus[i]];
      }
      rebuildAll();
    });

    resetBtn.addEventListener("click", () => {
      if (isSpinning) return;
      currentRotation = 0;
      gsap.set(wheelGroup, { rotation: 0, transformOrigin: "50% 50%" });
      resultText.textContent = "â€”";
    });

    // ===== Init =====
    rebuildAll();
  </script>
</body>
</html>
